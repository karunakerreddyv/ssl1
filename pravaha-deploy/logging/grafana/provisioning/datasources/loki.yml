# =============================================================================
# Grafana Datasource Provisioning - Loki
# Auto-configures Loki as the default datasource
# =============================================================================

apiVersion: 1

datasources:
  - name: Loki
    type: loki
    access: proxy
    url: http://loki:3100
    isDefault: true
    editable: false
    jsonData:
      maxLines: 1000
      timeout: 60
      derivedFields:
        # Extract request ID from logs for correlation
        - datasourceUid: loki
          matcherRegex: '"requestId":"([^"]+)"'
          name: RequestID
          url: ''
        # Extract user ID
        - datasourceUid: loki
          matcherRegex: '"userId":"([^"]+)"'
          name: UserID
          url: ''
