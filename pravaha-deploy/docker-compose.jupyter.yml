# ===========================================================================
# Pravaha Platform - Jupyter Notebook Server (Optional)
# ===========================================================================
# This is an optional service for interactive notebook execution.
# Run with: docker compose -f docker-compose.yml -f docker-compose.jupyter.yml up -d
# Stop with: docker compose -f docker-compose.yml -f docker-compose.jupyter.yml down
# ===========================================================================

services:
  jupyter:
    image: ${JUPYTER_IMAGE:-jupyter/scipy-notebook:2024-01-15}
    container_name: pravaha-jupyter
    restart: unless-stopped
    ports:
      - "127.0.0.1:8888:8888"
    environment:
      - JUPYTER_TOKEN=${JUPYTER_TOKEN:-pravaha-jupyter-token-2025}
      - JUPYTER_ENABLE_LAB=yes
      - GRANT_SUDO=yes
      - NB_UID=1000
      - NB_GID=100
    volumes:
      - jupyter_notebooks:/home/jovyan/work
      - jupyter_data:/home/jovyan/data
      - ./notebooks:/home/jovyan/shared:rw
    command: >
      start-notebook.py
      --NotebookApp.allow_origin='*'
      --NotebookApp.disable_check_xsrf=True
      --NotebookApp.allow_root=True
      --ServerApp.terminado_settings='{"shell_command": ["/bin/bash"]}'
    user: root
    networks:
      - pravaha-network
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8888/api/status || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s

volumes:
  jupyter_notebooks:
    driver: local
  jupyter_data:
    driver: local

networks:
  pravaha-network:
    external: true
